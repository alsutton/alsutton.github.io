<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme="dark"
><head>
  <title>
    Al Sutton
      |
      Hosting build artifacts on AWS


    

  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.89.4" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta
    name="description"
    content="
      


    "
  />
  
  
  
  <link
    rel="stylesheet"
    href="/css/main.min.51423ad97099a08f3a20e16d238c13adae76db7dd5e1913789bdc81143ff4cc6.css"
    integrity="sha256-UUI62XCZoI86IOFtI4wTra52233V4ZE3ib3IEUP/TMY="
    crossorigin="anonymous"
    type="text/css"
  />
  
  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css"
    integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS&#43;yuWSR4="
    crossorigin="anonymous"
    type="text/css"
  />
  
    
    
    <link
      rel="stylesheet"
      href="/css/center-image.min.a5cbbd5753ebe48351a006c534a28178d184393f85aed1a6ab256ec7d724af63.css"
      integrity="sha256-pcu9V1Pr5INRoAbFNKKBeNGEOT&#43;FrtGmqyVux9ckr2M="
      crossorigin="anonymous"
      media="screen"
    />

  
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
    crossorigin="anonymous"
  />
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />

  <link rel="canonical" href="/post/maven-artifacts-on-aws/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.2a2cd9614b7d007dfbb75e8da19e3a0fa872ceab53c6d000c00b7a0c89b85bfc.js"
    integrity="sha256-KizZYUt9AH37t16NoZ46D6hyzqtTxtAAwAt6DIm4W/w="
    crossorigin="anonymous"
  ></script>

  
    
    
    <script
      type="text/javascript"
      src="/js/anatole-theme-switcher.min.7fd87181cdd7e8413aa64b6867bb32f3a8dc242e684fc7d5bbb9f600dbc2b6eb.js"
      integrity="sha256-f9hxgc3X6EE6pktoZ7sy86jcJC5oT8fVu7n2ANvCtus="
      crossorigin="anonymous"
    ></script>

  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Hosting build artifacts on AWS"/>
<meta name="twitter:description" content="With JCenter closing down folks are looking at alternative places to host their build artifacts, and AWS can easily meet that need. AWS isn&rsquo;t the only platform capable of hosting Maven artifacts, any hosting provide can do it, but AWS has the ability to scale to high levels and offers a free tier which means that you can get started very cheaply and, if your libraries are really successful, you don&rsquo;t need to revisit the set-up unless you want to."/>



  
</head>
<body>
    <header><div
  class="page-top 
    .

  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true"></span>
    <span aria-hidden="true"></span>
    <span aria-hidden="true"></span>
  </a>
  <nav>
    <ul class="nav__list" id="navMenu">
      <div class="nav__links">
        
        
          
          <li>
            <a
              
              href="/"
              
              title=""
              >Home</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/post/"
              
              title=""
              >Posts</a
            >
          </li>

        
          
          <li>
            <a
              
              href="https://github.com/alsutton"
              
                target="_blank" rel="noopener noreferrer"

              
              title=""
              >Projects</a
            >
          </li>

        
        
      </div>
      <li>
        
          <a class="theme-switch" title="Switch Theme">
            <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
          </a>

        
      </li>
    </ul>
  </nav>
</div>
</header>
    <div class="wrapper">
      <aside><div
  class="sidebar
    .

  "
>
  <div class="sidebar__content">
    <div class="logo-title">
      <div class="title">
        <img src="/images/profile.jpeg" alt="profile picture" />
        <h3 title=""><a href="/">Al Sutton</a></h3>
        <div class="description">
          <p></p>
        </div>
      </div>
    </div>
    <ul class="social-links">
      
        <li>
          <a href="https://www.linkedin.com/in/alsutton/" rel="me" aria-label="Linkedin">
            <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li>
          <a href="https://github.com/alsutton" rel="me" aria-label="GitHub">
            <i class="fab fa-github fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li>
          <a href="https://www.alsutton.blog/index.xml" rel="me" aria-label="RSS">
            <i class="fas fa-rss fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
    </ul>
  </div><footer class="footer footer--sidebar">
  <div class="by_farbox">
    <ul class="footer__list">
      <li class="footer__item">
        &copy;
        
          Al Sutton
          2021


        
      </li>
      
    </ul>
  </div>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.71100d84fab0ad794b8399a66ac810700cc78d703f715dc10af4d7ba7b761362.js"
    integrity="sha256-cRANhPqwrXlLg5mmasgQcAzHjXA/cV3BCvTXunt2E2I="
    crossorigin="anonymous"
  ></script></div>
</aside>
      <main>
        <div class="autopagerize_page_element">
          <div class="content">
  <div
    class="post 
      .

    "
  >
    <div class="post-content">
      
      <div class="post-title">
        <h1>Hosting build artifacts on AWS</h1>
        
          <div class="info">
            <em class="fas fa-calendar-day"></em>
            <span class="date"
              >
                Thu, Feb 25, 2021


              </span
            >
            <em class="fas fa-stopwatch"></em>
            <span class="reading-time">9-minute read</span>
          </div>

        
      </div><p>With <a href="https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/">JCenter closing down</a> folks are looking at alternative places to host their build
artifacts, and AWS can easily meet that need. AWS isn&rsquo;t the only platform capable of 
hosting Maven artifacts, any hosting provide can do it, but AWS has the ability to scale
to high levels and offers a <a href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc">free tier</a> which means
that you can get started very cheaply and, if your libraries are really successful, you don&rsquo;t need to
revisit the set-up unless you want to.</p>
<p>The first part of this post will cover setting up AWS to serve your libraries, if you have
another hosting provider you&rsquo;re happy with you can skip to the 
<a href="#folder-layout">section which describes where to put your files</a> so that build tools
will be able to find the files they need.</p>
<h2 id="create-an-aws-account">Create an AWS Account</h2>
<p>If you don&rsquo;t already have one you will need to <a href="https://portal.aws.amazon.com/billing/signup">create an AWS Account</a>.</p>
<h2 id="decide-on-whether-youll-use-a-custom-domain-name">Decide on whether you&rsquo;ll use a custom domain name</h2>
<p>The reason you need to think about this now is because it will affect the name of the S3 bucket you create below.
Personally I would recommend using your own domain, this allows you to move the hosting around if 
you want to without all of your libraries users needing to update their configuration. It&rsquo;s not 
absolutely necessary though, so if you&rsquo;re running through this post to see how things work you 
shouldn&rsquo;t feel the need to go and register a domain.</p>
<p>If you already have a DNS domain registered you will need to be able to create a DNS <code>CNAME</code> 
record. This is something your domain registrar should have instructions for, and the instructions
will vary between domain name registrars. If you want to keep everything in AWS you can use 
<a href="https://aws.amazon.com/route53/">AWS Route 53</a> which will do the job.</p>
<h2 id="setting-up-the-simple-storage-service-s3">Setting up the Simple Storage Service (S3)</h2>
<p>Go to the <a href="https://s3.console.aws.amazon.com/s3/home">S3 control panel</a> and create a bucket with 
either the domain name you want to serve your artifacts from, or, if you don&rsquo;t want to use a 
custom domain name, a short name which will be the start of the URL you provide your libraries from.</p>
<p>The AWS region you want to use is entirely up to you. I&rsquo;m in the UK, so I use &ldquo;<code>EU (London) eu-west-2</code>&rdquo;
out of habit. If you think your library will appeal to folk in a certain area you might want to use
a region close to where your users are (e.g. for a library focused on supporting the Hindi language, 
you might want to use &ldquo;<code>Asia Pacific (Mumbai) ap-south-1</code>&rdquo; so downloads are slightly faster for users
in India).</p>
<p>You should make sure you turn off &ldquo;Block Public Access settings for bucket&rdquo;. You want your artifacts
to be available publicly, and this setting prevents that, so it needs to be switched off. You will
need to click the acknowledgement box to confirm that you want to be able to make things uploaded
to your bucket available to everyone.</p>
<p><img src="/images/2021-02-26-s3-block-public-access.jpg" alt="S3 Creations with Public Access Off"></p>
<p>You can then scroll to the bottom of the page and click &ldquo;Create Bucket&rdquo; to create the bucket.</p>
<h2 id="turn-on-static-website-hosting">Turn on &ldquo;Static website hosting&rdquo;</h2>
<p>To serve files from the bucket to your users you&rsquo;ll need to turn on &ldquo;Static website hosting&rdquo;. 
You can do this by  clicking on the bucket in the bucket list in the S3 control console, then 
clicking on the &ldquo;Properties&rdquo; option;</p>
<p><img src="/images/2021-02-25-s3-bucket-properties.jpg" alt="S3 Bucket Properties Screenshot"></p>
<p>Then scroll to the bottom of the page where you&rsquo;ll see the &ldquo;Static website hosting&rdquo;
option.</p>
<p><img src="/images/2021-02-26-s3-static-hosting-property.jpg" alt="S3 Bucket Hosting Properties Screenshot"></p>
<p>If it says &ldquo;Disabled&rdquo; you will need to click the &ldquo;Edit&rdquo; button, change the
value to &ldquo;Enabled&rdquo;, leave the &ldquo;Hosting Type&rdquo; option set to &ldquo;Host a static website&rdquo;,
enter <code>index.html</code> in the box titled &ldquo;Index Document&rdquo;, and then click &ldquo;Save Changes&rdquo;</p>
<p><img src="/images/2021-02-26-s3-static-hosting-edit.jpg" alt="S3 Static Hosting Screenshot"></p>
<p>Once you&rsquo;ve done this you can scroll to the bottom of the bucket properties to
confirm that static hosting is now turned on for the bucket. This is also where 
you&rsquo;ll find the URL which S3&rsquo;s web serving service has associated with your 
bucket (for this example it&rsquo;s
<code>http://test-maven.alsutton.com.s3-website.eu-west-2.amazonaws.com</code>).</p>
<p><img src="/images/2021-02-26-s3-static-hosting-on.jpg" alt="S3 Static Hosting On Screenshot"></p>
<p>If you&rsquo;ve decided not to use a custom domain this is the URL you&rsquo;ll give folk
who want to use your library.</p>
<h2 id="custom-domain-update">Custom Domain Update</h2>
<p>If you&rsquo;ve chosen to use a custom domain, this is where you need to go to your
DNS registrar and create the <code>CNAME</code> mentioned earlier. Your <code>CNAME</code> will map
the domain you want to make public to the s3 web serving domain that you saw
at the end of the last section.</p>
<p>For the example domain above (<code>test-maven.alsutton.com</code>) I would create a <code>CNAME</code>
record which points to <code>test-maven.alsutton.com.s3-website.eu-west-2.amazonaws.com</code>.</p>
<p><img src="/images/2021-02-26-domain-cname.jpg" alt="CNAME Creation Screenshot"></p>
<p><em>Warning:</em> The Domain Name System (DNS) caches both successful and failed look-ups. When
you create your <code>CNAME</code> it may be some time before everyone in the world can see it,
and, similarly, if you update the <code>CNAME</code> the change make take a while to propagate,
so don&rsquo;t be surprised if you can&rsquo;t use your custom domain immediately. It&rsquo;s a good
idea to allow a day or two between setting everything up and letting folk know about
the domain.</p>
<h2 id="a-quick-test">A quick test</h2>
<p>We can test to see if our S3 backed web serving is working by uploading a simple
HTML index page and trying to access it. You can create an <code>index.html</code> file
which contains <code>&lt;html&gt;&lt;body&gt;&lt;H1&gt;IT WORKED!!!!!!!!&lt;/H1&gt;&lt;/body&gt;&lt;/html&gt;</code>, and
use the <a href="https://s3.console.aws.amazon.com/s3/home">S3 control panel</a> to
upload it to your bucket (Click on the bucket name, then click on the &ldquo;upload&rdquo;
button and follow the instructions).</p>
<p>You now need to make the file available to everyone. The S3 control panel
is a bit clumsy when it comes to editing permissions, so you&rsquo;ll need to click on
the <code>index.html</code> file you&rsquo;ve just uploaded, then select &ldquo;Make Public&rdquo; from the 
&ldquo;Object Actions&rdquo; menu, then confirm your choice by clicking the &ldquo;Make Public&rdquo; 
button.</p>
<p><img src="/images/2021-02-26-s3-object-make-public.jpg" alt="S3 Make Public Screenshot"></p>
<p>If the DNS <code>CNAME</code> has propagated to your local DNS servers you should be 
able to access your test page using the URL <code>http://{your domain}/index.html</code>. If
you get an error saying the domain does not exist the <code>CNAME</code> creation may not
have reached your servers yet, and if you get an error starting 40 (usually 404
or 403) it means that you should check you made the index.html public in the S3
control panel.</p>
<h2 id="folder-layout">Folder Layout</h2>
<p>Ensuring your library files are in the right place is the most important thing to get right. If you
get it wrong, your library artifacts won&rsquo;t be found by any build tool.</p>
<p>Fortunately it&rsquo;s easy to translate an artefact name into the correct layout; You
need to create a nested set of folders with one for each section of the &ldquo;group&rdquo; which has a dot
(<code>.</code>) between them, then another folder for the artefact name, then a final folder for the version,
which is where you place your release files which we&rsquo;ll create below.</p>
<p>For example, for <code>com.alsutton:java-cryptography-wrapper:1.0</code> all of the relevant
files go in <code>com/alsutton/java-cryptography-wrapper/1.0/</code>. For <code>com.alsutton:java-cryptography-wrapper:1.1</code>
they would go in <code>com/alsutton/java-cryptography-wrapper/1.1/</code> and so on.</p>
<p>Inside Amazons S3 control panel you can create each folder using the &ldquo;Create Folder&rdquo; button,
and when you&rsquo;ve created the right structure you should see something like this;</p>
<p><img src="/images/2021-02-26-s3-bucket-directories.jpg" alt="S3 Console Screenshot"></p>
<h2 id="creating-the-files-to-upload">Creating the files to upload</h2>
<p>If you&rsquo;re using Gradle you can make use of the <a href="https://docs.gradle.org/current/userguide/publishing_maven.html">Maven Publishing Plugin</a>
to create the files you need to make available. If you&rsquo;re unsure of how to configure the plugin you can use the 
<a href="https://github.com/alsutton/java-cryptography-wrapper/commit/0b97be4d61517bb6a3a342b88cbf688f8a1f3017">configuration from one of my projects</a>
as a template.</p>
<p>With the Gradle Maven Publishing Plugin configured you should now be able to create the maven artifacts
locally by running the following command;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ gradlew publishToMavenLocal 
</code></pre></div><p>This will create a set of files in a local folder which is usually inside &ldquo;{your_home_directory}/.m2/repository/&rdquo;
and, from there, follows the same folder layout we created in the section above (e.g. <code>com/alsutton/java-cryptography-wrapper/1.0</code>).</p>
<h2 id="uploading-the-files">Uploading the files</h2>
<p>Now you&rsquo;ve found your files you will need to upload them to your S3 bucket and make them public in the same way we 
uploaded the index.html file for our earlier test. You will need to make sure that these files 
(.module, .pom, etc.) are uploaded and public for other people to be able to find your library. If any of these
are missing, or aren&rsquo;t public, users will see errors such as being told there was a &ldquo;403 error&rdquo; fetching your library.</p>
<p>To make things easier for users you should also upload and make public the maven metadata file that&rsquo;s available one
folder above the other files. When you publish locally you will get a folder called <code>maven-metadata-local.xml</code>,
you will need to rename this <code>maven-metadata.xml</code> before uploading it to the same location that it&rsquo;s in on your local 
machine (so in the <code>artefact_name</code> folder, not in <code>artefact_name/1.0</code>).</p>
<h2 id="using-your-new-repository">Using your new repository</h2>
<p>Congratulations, your library is now available!</p>
<p>If you&rsquo;re targeting folk who use gradle they will need to add in your repository to their builds. They can do this
by adding the following to their gradle build files;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">repositories {
    maven {
        url = uri(<span style="color:#e6db74">&#34;http://{your_domain}/&#34;</span>)
    }
}
</code></pre></div><p>They can now reference your library using gradle&rsquo;s normal dependency declaration (e.g., for the artefact
in the &ldquo;Folder Layout&rdquo; section, they would add <code>implementation(&quot;com.alsutton:java-cryptography-wrapper:1.0&quot;)</code>).</p>
<h2 id="optional-going-next-level---content-delivery-network-and-https">(optional) Going Next Level - Content Delivery Network and HTTPS</h2>
<p>So far what we have will only serve artifacts via http, and so could be susceptible to a 
<a href="https://en.wikipedia.org/wiki/Supply_chain_attack">Supply Chain Attack</a>, and it&rsquo;s from an S3 bucket in a single
location, meaning some folk will see slower downloads because they&rsquo;re geographically far away from where the S3 bucket
is being served from.</p>
<p>Fortunately AWS has a solution to both of these problems, it&rsquo;s called <a href="https://aws.amazon.com/cloudfront/">CloudFront</a>.
CloudFront is part of the AWS free tier, and they have some <a href="https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-https-requests-s3/">simple documentation</a> 
which covers using CloudFront to provide distributed, HTTPS secured, serving for data which is coming from an S3 
bucket, which will take you through how to set everything up.</p>
<p>If you&rsquo;re providing libraries to others I would recommend setting up CloudFront. You&rsquo;re not only giving them a
better experience through using a CDN to provide your library faster than the S3 bucket would, you&rsquo;re also giving
them confidence that your library has not been altered by a third party at some point between you and them</p>
<h2 id="thats-all-folks">That&rsquo;s all folks</h2>
<p>Hopefully you&rsquo;ve found this useful. You&rsquo;ve now reduced the risk of building up a following for a library using
a third party repository, and then being hit by that repository closing, causing a lot of work for your users,
and you&rsquo;ve also given your users an easy way to find the authoritative source for the latest versions of your
library.</p>
<p>If you have questions you can find me on <a href="https://mastodon.social/@alsutton">Mastodon</a>, <a href="https://github.com/alsutton/">GitHub</a>,
and <a href="https://twitter.com/alsutton">Twitter</a>.</p>
</div>
    <div class="post-footer">
      <div class="info">
        
          <span class="separator"><a class="category" href="/categories/Software-Development/">Software Development</a></span>




        

        
      </div>
    </div>

    
  </div>


          </div>
        </div>
      </main>
    </div><footer class="footer footer--base">
  <div class="by_farbox">
    <ul class="footer__list">
      <li class="footer__item">
        &copy;
        
          Al Sutton
          2021


        
      </li>
      
    </ul>
  </div>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.71100d84fab0ad794b8399a66ac810700cc78d703f715dc10af4d7ba7b761362.js"
    integrity="sha256-cRANhPqwrXlLg5mmasgQcAzHjXA/cV3BCvTXunt2E2I="
    crossorigin="anonymous"
  ></script></body>
</html>
