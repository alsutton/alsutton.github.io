<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme="dark"
  
    class="html theme--dark"
  
><head>
  <title>
    Al Sutton
        |
        Working with android firmware
      

    

  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.85.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="author" content="Al Sutton" />
  <meta
    name="description"
    content=""
  />
  
  
    
    
    <link
      rel="stylesheet"
      href="/scss/main.min.5794be192d21535bdd301561e043a96b6adbad2b5c08279deff459e4661c613f.css"
      integrity="sha256-V5S&#43;GS0hU1vdMBVh4EOpa2rbrStcCCed7/RZ5GYcYT8="
      crossorigin="anonymous"
      type="text/css"
    />
  

  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css"
    integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU="
    crossorigin="anonymous"
    type="text/css"
  />
  
    
    
    <link
      rel="stylesheet"
      href="/css/center-image.min.a5cbbd5753ebe48351a006c534a28178d184393f85aed1a6ab256ec7d724af63.css"
      integrity="sha256-pcu9V1Pr5INRoAbFNKKBeNGEOT&#43;FrtGmqyVux9ckr2M="
      crossorigin="anonymous"
      media="screen"
    />
  
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/fontawesome.min.7f3c2281c7f965ce3c64888aa452793252a0416909c181097f81d0a0f7d1624e.css"
    integrity="sha256-fzwigcf5Zc48ZIiKpFJ5MlKgQWkJwYEJf4HQoPfRYk4="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/solid.min.35fc032da8ede6681675d20a2f862fb9e1045c1d512d495fcf862c054daffef2.css"
    integrity="sha256-NfwDLajt5mgWddIKL4YvueEEXB1RLUlfz4YsBU2v/vI="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/regular.min.3b92357925ea7284f0c6b0378396f39f470f7842ed9702f337e667c4026bf837.css"
    integrity="sha256-O5I1eSXqcoTwxrA3g5bzn0cPeELtlwLzN&#43;ZnxAJr&#43;Dc="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/brands.min.ebb1096e1976e8cc4e2532cfa050b8f30eb13b8eb06be5cee3e38eb426b838ea.css"
    integrity="sha256-67EJbhl26MxOJTLPoFC48w6xO46wa&#43;XO4&#43;OOtCa4OOo="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />

  <link rel="canonical" href="/post/working-with-android-firmware/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.46e6a54097480084f8f52c20ca1aa7425b4fad17029a887fd4017b12e311a72d.js"
    integrity="sha256-RualQJdIAIT49SwgyhqnQltPrRcCmoh/1AF7EuMRpy0="
    crossorigin="anonymous"
  ></script>

  
    
    
    <script
      type="text/javascript"
      src="/js/anatole-theme-switcher.min.4c31f3cf7e8e609c897dba88aecac0e8db1ebb4e5c841d3f9ffb01d463973678.js"
      integrity="sha256-TDHzz36OYJyJfbqIrsrA6Nseu05chB0/n/sB1GOXNng="
      crossorigin="anonymous"
    ></script>
  

  


  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Working with android firmware"/>
<meta name="twitter:description" content="Occasionally I get asked &ldquo;How do I make my own Android build?&rdquo;. In this post I&rsquo;m going to give you some tips and information which will hopefully give you a better idea of what&rsquo;s needed.
Step 1: Check your setup First off you&rsquo;re going to need a machine capable of running Linux and has at least 500 GB of disk space and 16 GB of RAM. I&rsquo;ve written a post before about what type of hardware is ideal, but, if you want to just test the water, you can use any machine with those specs."/>



  
  <meta property="og:title" content="Working with android firmware" />
<meta property="og:description" content="Occasionally I get asked &ldquo;How do I make my own Android build?&rdquo;. In this post I&rsquo;m going to give you some tips and information which will hopefully give you a better idea of what&rsquo;s needed.
Step 1: Check your setup First off you&rsquo;re going to need a machine capable of running Linux and has at least 500 GB of disk space and 16 GB of RAM. I&rsquo;ve written a post before about what type of hardware is ideal, but, if you want to just test the water, you can use any machine with those specs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/working-with-android-firmware/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-05T14:45:54+00:00" />
<meta property="article:modified_time" content="2021-07-05T14:45:54+00:00" /><meta property="og:site_name" content="Al Sutton" />




  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "post",
        "name": "Working with android firmware",
        "headline": "Working with android firmware",
        "alternativeHeadline": "",
        "description": "
      
        Occasionally I get asked \u0026ldquo;How do I make my own Android build?\u0026rdquo;. In this post I\u0026rsquo;m going to give you some tips and information which will hopefully give you a better idea of what\u0026rsquo;s needed.\nStep 1: Check your setup First off you\u0026rsquo;re going to need a machine capable of running Linux and has at least 500 GB of disk space and 16 GB of RAM. I\u0026rsquo;ve written a post before about what type of hardware is ideal, but, if you want to just test the water, you can use any machine with those specs.


      


    ",
        "inLanguage": "en-gb",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/post\/working-with-android-firmware\/"
        },
        "author" : {
            "@type": "Person",
            "name": "alsutton"
        },
        "creator" : {
            "@type": "Person",
            "name": "alsutton"
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": "alsutton"
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": "alsutton"
        },
        "copyrightYear" : "2021",
        "dateCreated": "2021-07-05T14:45:54.00Z",
        "datePublished": "2021-07-05T14:45:54.00Z",
        "dateModified": "2021-07-05T14:45:54.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "alsutton",
            "url": "/",
            "logo": {
                "@type": "ImageObject",
                "url": "\/favicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
      ]

    ,
        "url" : "\/post\/working-with-android-firmware\/",
        "wordCount" : "1480",
        "genre" : [ 
      
      "AOSP"

    ],
        "keywords" : [ ]
    }
  </script>


</head>
<body class="body">
    <div class="wrapper">
      <aside
        
          class="wrapper__sidebar"
        
      ><div
  class="sidebar
    .
  "
>
  <div class="sidebar__content">
    <div class="sidebar__introduction">
      <img
        class="sidebar__introduction-profileimage"
        src="/images/profile.jpeg"
        alt="profile picture"
      />
      
        <div class="sidebar__introduction-title">
          <a href="/">Al Sutton</a>
        </div>
      
      <div class="sidebar__introduction-description">
        <p></p>
      </div>
    </div>
    <ul class="sidebar__list">
      
        <li class="sidebar__list-item">
          <a
            href="https://www.linkedin.com/in/alsutton/"
            target="_blank"
            rel="noopener me"
            aria-label="Linkedin"
            title="Linkedin"
          >
            <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      
        <li class="sidebar__list-item">
          <a
            href="https://github.com/alsutton"
            target="_blank"
            rel="noopener me"
            aria-label="GitHub"
            title="GitHub"
          >
            <i class="fab fa-github fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      
        <li class="sidebar__list-item">
          <a
            href="https://snapp.social/@alsutton"
            target="_blank"
            rel="noopener me"
            aria-label="Mastodon"
            title="Mastodon"
          >
            <i class="fab fa-mastodon fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      
        <li class="sidebar__list-item">
          <a
            href="https://www.alsutton.blog/index.xml"
            target="_blank"
            rel="noopener me"
            aria-label="RSS"
            title="RSS"
          >
            <i class="fas fa-rss fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      
    </ul>
  </div><footer class="footer footer__sidebar">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        Al Sutton
        2022
      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.fae9ac8895995fe91958b3954be11e96025824a04770726a3531e119ddd2d576.js"
    integrity="sha256-&#43;umsiJWZX&#43;kZWLOVS&#43;EelgJYJKBHcHJqNTHhGd3S1XY="
    crossorigin="anonymous"
  ></script></div>
</aside>
      <main
        
          class="wrapper__main"
        
      >
        <header class="header"><div
  class="
    .
  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
  </a>
  <nav class="nav">
    <ul class="nav__list" id="navMenu">
      
      
        
        
          <li class="nav__list-item">
            <a
              
              href="/"
              
              title=""
              >Home</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            <a
              
              href="/post/"
              
              title=""
              >Posts</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            <a
              
              href="https://github.com/alsutton"
              
                target="_blank" rel="noopener noreferrer"
              
              title=""
              >Projects</a
            >
          </li>
        

      
    </ul>
    <ul class="nav__list nav__list--end">
      
      
        <li class="nav__list-item">
          <div class="themeswitch">
            <a title="Switch Theme">
              <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a>
          </div>
        </li>
      
    </ul>
  </nav>
</div>
</header>
  <div
    class="post 
      .
    "
  >
    
    <div class="post__content">
      <h1>Working With Android Firmware</h1>
      
        <ul class="post__meta">
          <li class="post__meta-item">
            <em class="fas fa-calendar-day post__meta-icon"></em>
            <span class="post__meta-text"
              >
                
                  Mon, Jul 5, 2021
                

              
            </span>
          </li>
          <li class="post__meta-item">
            <em class="fas fa-stopwatch post__meta-icon"></em>
            <span class="post__meta-text">7-minute read</span>
          </li>
        </ul>
      <p>Occasionally I get asked &ldquo;How do I make my own Android build?&rdquo;. In this post I&rsquo;m going to give you some tips and
information which will hopefully give you a better idea of what&rsquo;s needed.</p>
<h2 id="step-1-check-your-setup">Step 1: Check your setup</h2>
<p><img src="/images/android-aosp-codelab.jpg" alt=""></p>
<p>First off you&rsquo;re going to need a machine capable of running Linux and has at least 500 GB of disk space and 16 GB of RAM. 
I&rsquo;ve  written a <a href="/post/2021-aosp-build-machine/">post</a> before about what type of hardware is ideal, but, if you want
to just test the water, you can use any machine with those specs.</p>
<p>The next step is to set up your machine and perform a build by following 
<a href="https://source.android.com/setup/start">Google&rsquo;s codelab</a>. This will give you a good idea of how long builds will
take, verify your machine is configured correctly, and give you an idea of whether making your own build is something 
you want to invest time in. There&rsquo;s a steep initial curve to make a build, and Google have already done a good job of covering it,
so I&rsquo;m not going to repeat the information here.</p>
<h2 id="step-2-building-for-the-device-youre-interested-in">Step 2: Building for the device you&rsquo;re interested in</h2>
<p>Next comes the question that has a big impact on how much work you&rsquo;ll be doing; Has someone already made a build for
the device you&rsquo;re interested in?</p>
<p>If someone has then you&rsquo;re in a good place. If someone hasn&rsquo;t then you&rsquo;re in 
for a tough time, and I wouldn&rsquo;t recommend trying to make a build for an unsupported device
as your first Android firmware project.</p>
<p>To make a build for a device you need some build configuration files, and a &ldquo;Board Support Package&rdquo; (BSP). The BSP
is a bundle of libraries and files which  provide the interface between the hardware and Android. Some 
<a href="https://android.googlesource.com/platform/hardware/bsp/">manufacturers have Android BSPs available</a>,
others may have Linux BSPs (which you will <a href="https://source.android.com/devices/architecture/hal-types">need to write additional code</a> 
to use), and some don&rsquo;t provide their BSPs at all.</p>
<p>For many Android devices you can find an existing project which has the BSP and configuration files you need. I&rsquo;ve 
recently been
working on getting Android Automotive OS up and running for the Galaxy Tab s5e, and the folks over at
<a href="https://lineageos.org/">LineageOS</a> have already got a <a href="https://wiki.lineageos.org/devices/gts4lv">working build</a>
which includes <a href="https://wiki.lineageos.org/devices/gts4lv/build#extract-proprietary-blobs">details on getting the BSP for the device</a>.
This means that I can start my work knowing Android can be built for the device.</p>
<p><img src="/images/lineage-wiki.jpg" alt=""></p>
<p>Before making any changes you should follow the instructions from the folk who have already created the firmware
for that device to make sure that you can create your own firmware build and deploy it to your device. Sometimes you may hit
unexpected problems, so it&rsquo;s best to start from a place where you have a working build. If the instructions from
the folk who&rsquo;ve created the build don&rsquo;t work you can reach out to them and try to resolve the problems.</p>
<h2 id="step-3-developing">Step 3: Developing</h2>
<p>During the first couple of steps you&rsquo;ll have been introduced to a few utilities and tools, and one of the most
important ones is the <code>build/envsetup.sh</code> script. The <code>envsetup</code> script configures some environment variables
and other things which a lot of the other tools rely on, so, if you hit issues, make sure you&rsquo;ve run <code>envsetup</code>
in the session/terminal window you&rsquo;re currently working in.</p>
<p>You should download and install <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>. IntelliJ is the default IDE for 
some scripts, so having it available will make things easier. You can use Android Studio,
but if you&rsquo;re working on lower level code you may find it&rsquo;s missing support for some things (e.g. Rust).</p>
<p>Now you&rsquo;re ready for the AOSP firmware development cycle;</p>
<h3 id="develop-aidegen">Develop: <code>aidegen</code></h3>
<p><code>aidegen</code> is a utility which will start IntelliJ with a project that contains a small subset of the firmware. The 
idea behind it is that trying to edit the entire firmware code in one project will bring most machines to their knees, 
so, instead, it creates views of the parts of the code for you to work on.</p>
<p>You specify which areas of the firmware you&rsquo;re going to work on, and let <code>aidegen</code> do the rest. If, for example,
you wanted to work on the <code>Settings</code> app, you would run;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">aidegen packages/apps/Settings
</code></pre></div><p>If you want to make changes to the launcher that&rsquo;s used in cars;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">aidegen packages/apps/Car/Launcher
</code></pre></div><p>If you want to work on multiple parts of the codebase you can supply multiple arguments, and aidegen will create a
minimal project which supports what you&rsquo;ve supplied.</p>
<p><code>aidegen</code> isn&rsquo;t perfect; There are some situations where you&rsquo;ll get unresolved symbols if one part of the build has used 
a transitive dependency, so you may have to add some projects to 
your <code>aidegen</code> call get those to resolve, or you can leave them and not worry about it.</p>
<h3 id="build-clobber-m-mm-and-mmm">Build: <code>clobber</code>, <code>m</code>, <code>mm</code>, and <code>mmm</code></h3>
<p>Now that you&rsquo;ve made your change you should create a new build. You can try to minimise your build time by
using <code>mmm</code> which will rebuild an individual project. For example, to rebuild the <code>Settings</code> app you would run</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mmm packages/apps/Settings
</code></pre></div><p>or, if you&rsquo;re in the <code>Settings</code> app in your terminal session, you can just run <code>mm</code>;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mm
</code></pre></div><p>Note that <code>mm</code> doesn&rsquo;t need a project path, it assumes you want to rebuild the project where you run it from.</p>
<p><code>m</code> is a shortcut for <code>make</code> which will check the whole build and rebuild everything it determines needs to be
rebuilt. This is sometimes useful if you&rsquo;re seeing some unexpected failures when you deploy your image to a device.</p>
<p><code>m clobber</code> is the way to clear out <em>everything</em> from previous builds. It&rsquo;s something you should use if you think
that that your change isn&rsquo;t being used due to a build caching issue. <code>clobber</code> is something you should avoid if possible because, as you
probably found out earlier, a full build takes a looooong time.</p>
<h3 id="deploy--flash-ota-or-adb">Deploy : Flash, OTA, or ADB</h3>
<p>Depending on how big your change is you may need to go through the device flashing process again, you might need
to create an OTA update package, or you may be able to <code>adb install</code> the apk which has changed. You should
be comfortable doing all three.</p>
<p>Flashing is device specific and ensures a particular area on the device only contains the files from your
build. Sometimes there is a key combination which will take a device into 
<a href="https://source.android.com/setup/build/running">fastboot mode</a> which you can use to flash a device.
Sometimes things a more complex; you&rsquo;ll hear talk of custom tools like 
<a href="https://en.wikipedia.org/wiki/Odin_(firmware_flashing_software)">Odin</a>. The
information on the recommended way of flashing your device can normally be found where you got
your original build from.</p>
<p><img src="/images/odin.jpg" alt=""></p>
<p>Full flashing images are large and flashing is a slow process, so you may want to distribute smaller &ldquo;Over The Air&rdquo; updates (OTAs). 
Google has a page which covers <a href="https://source.android.com/devices/tech/ota/tools">OTA builds</a>, and you can use tools like <code>adb sideload</code> to put them onto a device. The
only down-side of an OTAis that you&rsquo;re not starting from an empty partition, so unless your OTA has been created to handle
removing unneeded files you may end up with unexpected additional code and files on your device.</p>
<p>The fastest method of all is updating a single apk. You can usually find the apks inside the <code>out/target/product</code>
directory in your build, so, if your change was only to the Car Launcher apk for the Samsung Tab s5e you can run;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">adb install out/target/product/gts4lvaaos/system/priv-app/CarLauncher/CarLauncher.apk
</code></pre></div><p>If the app isn&rsquo;t currently being used its apk can be updated like this, but, if you think the apk hasn&rsquo;t deployed,
you might want to restart the device to ensure the right version of the app is running.</p>
<h3 id="test-atest">Test: atest</h3>
<p>Some projects in the AOSP have unit tests which you can run in the IDE. This is great for making sure that 
your code hasn&rsquo;t broken anything obvious, but there are usually some more extensive tests you can run, and for that 
there&rsquo;s <code>atest</code>.</p>
<p><code>atest</code> has its <a href="https://source.android.com/compatibility/tests/development/atest">own page</a> on the AOSP site 
explaining how you can set it up, and, at the simplest level, you can run it in the same way you ran <code>aidegen</code> 
by specifying the project you want to test. So, for example, to test the <code>Settings</code> app after you&rsquo;ve deployed
your changes and have the device responding to adb, you can run;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">atest packages/apps/Settings
</code></pre></div><h3 id="repeat">Repeat</h3>
<p>Those four steps are your development cycle. You write your change, build it, deploy it, and then test it. It&rsquo;s
initially slower than most app development because there&rsquo;s a lot more code to initially build, but, by using <code>aidegen</code>
and keeping your changes small and isolated you can make a reasonable number of changes per hour and achieve a 
decent development velocity.</p>
<h2 id="feedback">Feedback</h2>
<p>This is a quick brain-dump of what I usually take people through when they&rsquo;re starting to build their own firmware 
images. If you have feedback on things that could be improved, added, or should be removed you can find me on 
<a href="https://mastodon.social/@alsutton">Mastodon</a>, <a href="https://github.com/alsutton/">GitHub</a>, 
and <a href="https://twitter.com/alsutton">Twitter</a>.</p>
</div>
    <div class="post__footer">
      
        <span><a class="category" href="/categories/AOSP/">AOSP</a></span>


      

      
    </div>

    
  </div>

      </main>
    </div><footer class="footer footer__base">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        Al Sutton
        2022
      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.fae9ac8895995fe91958b3954be11e96025824a04770726a3531e119ddd2d576.js"
    integrity="sha256-&#43;umsiJWZX&#43;kZWLOVS&#43;EelgJYJKBHcHJqNTHhGd3S1XY="
    crossorigin="anonymous"
  ></script></body>
</html>
